import{_ as o}from"./plugin-vue_export-helper-c27b6911.js";import{r as l,o as i,c,a as n,b as s,d as e,e as t}from"./app-9fa36ab2.js";const p={},r=n("h2",{id:"drone-ci-文件生成",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#drone-ci-文件生成","aria-hidden":"true"},"#"),s(" Drone CI 文件生成")],-1),u=n("blockquote",null,[n("p",null,"goctls > 1.5.17")],-1),d={class:"hint-container info"},k=n("p",{class:"hint-container-title"},"相关信息",-1),m={href:"https://www.bilibili.com/video/BV1ZN411b7sp",target:"_blank",rel:"noopener noreferrer"},v=t(`<h2 id="创建-drone-ci-文件" tabindex="-1"><a class="header-anchor" href="#创建-drone-ci-文件" aria-hidden="true">#</a> 创建 Drone CI 文件</h2><blockquote><p>创建 .drone.yaml 与 Dockerfile 文件</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>goctls cicd drone <span class="token parameter variable">-d</span><span class="token operator">=</span><span class="token string">&quot;core&quot;</span> <span class="token parameter variable">-g</span><span class="token operator">=</span><span class="token string">&quot;gitee.com&quot;</span> <span class="token parameter variable">-s</span><span class="token operator">=</span><span class="token string">&quot;core&quot;</span> <span class="token parameter variable">-x</span><span class="token operator">=</span><span class="token string">&quot;rpc&quot;</span> <span class="token parameter variable">-b</span><span class="token operator">=</span><span class="token string">&quot;master&quot;</span> <span class="token parameter variable">-r</span><span class="token operator">=</span><span class="token string">&quot;registry.cn-beijing.aliyuncs.com&quot;</span> <span class="token parameter variable">-o</span><span class="token operator">=</span><span class="token string">&quot;registry.cn-hangzhou.aliyuncs.com/simple_admin/core-api-docker:v1.1.0&quot;</span> <span class="token parameter variable">-e</span><span class="token operator">=</span><span class="token string">&quot;core&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,3),b={class:"hint-container warning"},g=n("p",{class:"hint-container-title"},"注意",-1),h=n("br",null,null,-1),_={href:"http://registry.cn-hangzhou.aliyuncs.com/simple_admin/core-api-docker",target:"_blank",rel:"noopener noreferrer"},y=n("br",null,null,-1),f={href:"http://registry.cn-hangzhou.aliyuncs.com/simple_admin/core-api-docker:v1.1.0",target:"_blank",rel:"noopener noreferrer"},q=n("h3",{id:"cicd-drone-参数介绍",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#cicd-drone-参数介绍","aria-hidden":"true"},"#"),s(),n("code",null,"cicd drone"),s(" 参数介绍")],-1),x=n("thead",null,[n("tr",null,[n("th",null,"参数"),n("th",null,"必须"),n("th",null,"默认值"),n("th",null,"介绍"),n("th",null,"使用方法")])],-1),D=n("tr",null,[n("td",null,"drone_name"),n("td",null,"否"),n("td",null,"drone-greet"),n("td",null,"Drone 名称"),n("td",null,"为 drone 自定义一个名称")],-1),w=n("td",null,"go_private",-1),z=n("td",null,"是",-1),N={href:"http://gitee.com",target:"_blank",rel:"noopener noreferrer"},R=n("td",null,"go 私有仓库设置",-1),T={href:"http://gitee.com",target:"_blank",rel:"noopener noreferrer"},C={href:"http://github.com",target:"_blank",rel:"noopener noreferrer"},O=n("tr",null,[n("td",null,"service_name"),n("td",null,"是"),n("td",null,"无"),n("td",null,"go-zero 服务主程序入口文件"),n("td",null,"例如: core.go, 必须省略后缀 .go")],-1),E=n("tr",null,[n("td",null,"service_type"),n("td",null,"否"),n("td",null,"happy"),n("td",null,"go-zero 服务类型"),n("td",null,"例如： rpc | api")],-1),j=n("tr",null,[n("td",null,"git_branch"),n("td",null,"否"),n("td",null,"main"),n("td",null,"git 仓库分支"),n("td",null,"需要到根据自己的 git 分支决定")],-1),I=n("td",null,"registry",-1),B=n("td",null,"是",-1),G=n("td",null,"无",-1),P=n("td",null,"远程镜像仓库地址",-1),V={href:"http://registry.cn-beijing.aliyuncs.com",target:"_blank",rel:"noopener noreferrer"},A=n("tr",null,[n("td",null,"repo"),n("td",null,"是"),n("td",null,"无"),n("td",null,"远程镜像仓库地址"),n("td",null,"如果 tag 不是 'latest' 需要指定，例如: git-repo:v0.0.1, 如果是 'latest' 则需要忽略")],-1),Y=n("tr",null,[n("td",null,"etc_yaml"),n("td",null,"是"),n("td",null,"无"),n("td",null,"drone 在 CI 过程中使用的 Dockerfile 配置"),n("td",null,"go-zero 项目中 etc 文件夹下的 yaml 配置文件名")],-1),L=t(`<p><strong>详细参数请在命令行查看 <code>goctls cicd drone -h</code></strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ goctls cicd drone <span class="token parameter variable">-h</span>
Generate Drone yaml and Dockerfile

Usage:
  goctls cicd drone <span class="token punctuation">[</span>flags<span class="token punctuation">]</span>

Flags:
  -d, <span class="token parameter variable">--drone_name</span> string     The Drone name
  -e, <span class="token parameter variable">--etc_yaml</span> string       The Dockerfile with drone used, go-zero project etc yaml <span class="token function">file</span> name <span class="token punctuation">(</span>required<span class="token punctuation">)</span>
  -b, <span class="token parameter variable">--git_branch</span> string     The branch of the remote repo, default <span class="token string">&quot;main&quot;</span>  <span class="token punctuation">(</span>default <span class="token string">&quot;master&quot;</span><span class="token punctuation">)</span>
  -g, <span class="token parameter variable">--go_private</span> string     Go private such as: gitee.com<span class="token operator">|</span>github.com, default <span class="token string">&quot;gitee.com&quot;</span> <span class="token punctuation">(</span>required<span class="token punctuation">)</span> <span class="token punctuation">(</span>default <span class="token string">&quot;gitee.com&quot;</span><span class="token punctuation">)</span>
  -h, <span class="token parameter variable">--help</span>                  <span class="token builtin class-name">help</span> <span class="token keyword">for</span> drone
  -r, <span class="token parameter variable">--registry</span> string       The remote Docker Registry, <span class="token keyword">if</span> aliyun ACR such as: registry.cn-beijing.aliyuncs.com <span class="token punctuation">(</span>required<span class="token punctuation">)</span>
  -o, <span class="token parameter variable">--repo</span> string           The remote Git Repository, <span class="token keyword">if</span> tag is not <span class="token string">&#39;latest&#39;</span> please assign tag such as: git-repo:v0.0.1, <span class="token keyword">if</span> tag is latest you can ignore the tag <span class="token punctuation">(</span>required<span class="token punctuation">)</span>
  -s, <span class="token parameter variable">--service_name</span> string   The <span class="token function">service</span> name of the main project go file, such as: core.go, you must ignore suffix: .go  <span class="token punctuation">(</span>required<span class="token punctuation">)</span>
  -x, <span class="token parameter variable">--service_type</span> string   The <span class="token function">service</span> <span class="token builtin class-name">type</span> such as: rpc<span class="token operator">|</span>api, default <span class="token string">&quot;happy&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>你可以看到以下结构 <br><br> 注意：mac 环境下生成的.drone.yml 默认为隐藏文件，需要指令<code>Command + Shift + . </code>才可见</p></blockquote><img width="298" alt="image" src="https://github.com/suyuan32/simple-admin-doc/assets/5540291/ff0ee451-bccd-4783-a92c-2a59f1a834a7"><h3 id="文件结构" tabindex="-1"><a class="header-anchor" href="#文件结构" aria-hidden="true">#</a> 文件结构</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>├── example                           go-zero项目
├── .drone.yml                        配置文件目录
└── Dockerfile                        Dockerfile配置文件
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>.drone.yml <br><br> yml 文件中 docker_username 和 docker_password 是 drone 中配置的拉取私有镜像的仓库的账户和密码</p></blockquote><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> pipeline
<span class="token key atrule">type</span><span class="token punctuation">:</span> docker
<span class="token key atrule">name</span><span class="token punctuation">:</span> core<span class="token punctuation">-</span>rpc
<span class="token key atrule">steps</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> build<span class="token punctuation">-</span>go
    <span class="token key atrule">image</span><span class="token punctuation">:</span> golang<span class="token punctuation">:</span>1.20.3
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>clone<span class="token punctuation">]</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> go_cache
        <span class="token key atrule">path</span><span class="token punctuation">:</span> /go/pkg/mod
    <span class="token key atrule">commands</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> go env <span class="token punctuation">-</span>w CGO_ENABLED=0
      <span class="token punctuation">-</span> go env <span class="token punctuation">-</span>w GOPROXY=https<span class="token punctuation">:</span>//goproxy.cn<span class="token punctuation">,</span>direct
      <span class="token punctuation">-</span> go env <span class="token punctuation">-</span>w GOPRIVATE=gitee.com
      <span class="token punctuation">-</span> go mod tidy <span class="token important">&amp;&amp;</span> go build <span class="token punctuation">-</span>trimpath <span class="token punctuation">-</span>ldflags &quot;<span class="token punctuation">-</span>s <span class="token punctuation">-</span>w&quot; <span class="token punctuation">-</span>o app core.go

  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> build<span class="token punctuation">-</span>rpc
    <span class="token key atrule">image</span><span class="token punctuation">:</span> plugins/docker<span class="token punctuation">:</span><span class="token number">20</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">DRONE_REPO_BRANCH</span><span class="token punctuation">:</span> master
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>build<span class="token punctuation">-</span>go<span class="token punctuation">]</span>
    <span class="token key atrule">settings</span><span class="token punctuation">:</span>
      <span class="token key atrule">dockerfile</span><span class="token punctuation">:</span> Dockerfile
      <span class="token key atrule">registry</span><span class="token punctuation">:</span> registry.cn<span class="token punctuation">-</span>beijing.aliyuncs.com
      <span class="token key atrule">repo</span><span class="token punctuation">:</span> registry.cn<span class="token punctuation">-</span>hangzhou.aliyuncs.com/simple_admin/core<span class="token punctuation">-</span>api<span class="token punctuation">-</span>docker<span class="token punctuation">:</span>v1.1.0
      <span class="token key atrule">auto_tag</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">insecure</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">username</span><span class="token punctuation">:</span>
        <span class="token key atrule">from_secret</span><span class="token punctuation">:</span> docker_username
      <span class="token key atrule">password</span><span class="token punctuation">:</span>
        <span class="token key atrule">from_secret</span><span class="token punctuation">:</span> docker_password
<span class="token key atrule">trigger</span><span class="token punctuation">:</span>
  <span class="token key atrule">ref</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> refs/tags/*
    <span class="token punctuation">-</span> refs/heads/master

<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> go_cache
    <span class="token key atrule">host</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /root/.go/cache
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Dockerfile</p></blockquote><div class="language-Dockefile line-numbers-mode" data-ext="Dockefile"><pre class="language-Dockefile"><code>FROM alpine

RUN apk update &amp;&amp; apk add tzdata
RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime

COPY ./app /app/
COPY ./etc/core.yaml /app/etc/core.yaml
workdir /app/
ENTRYPOINT [&quot;./app&quot;]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,10);function S(U,F){const a=l("ExternalLinkIcon");return i(),c("div",null,[r,u,n("div",d,[k,n("p",null,[n("a",m,[s("视频教程"),e(a)])])]),v,n("div",b,[g,n("p",null,[s("repo 参数"),h,s(' latest 则为：-o="'),n("a",_,[s("registry.cn-hangzhou.aliyuncs.com/simple_admin/core-api-docker"),e(a)]),s('"'),y,s(' 非 latest 则为：-o="'),n("a",f,[s("registry.cn-hangzhou.aliyuncs.com/simple_admin/core-api-docker:v1.1.0"),e(a)]),s('"')])]),q,n("table",null,[x,n("tbody",null,[D,n("tr",null,[w,z,n("td",null,[n("a",N,[s("gitee.com"),e(a)])]),R,n("td",null,[s("例如： "),n("a",T,[s("gitee.com"),e(a)]),s(" | "),n("a",C,[s("github.com"),e(a)])])]),O,E,j,n("tr",null,[I,B,G,P,n("td",null,[s("例如阿里云镜像地址: "),n("a",V,[s("registry.cn-beijing.aliyuncs.com"),e(a)])])]),A,Y])]),L])}const X=o(p,[["render",S],["__file","1-drone.html.vue"]]);export{X as default};
